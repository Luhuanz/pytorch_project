<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>âš”ï¸Mnistæ‰‹å†™æ•°æ®é›†å®éªŒæŠ¥å‘Š</title>
    <meta charset="utf-8" />
    <meta name="author" content="é™†ä½³æ¬¢" />
    <meta name="author" content="åº”æ•°2001" />
    <meta name="date" content="2022-04-06" />
    <script src="PPt_files/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# âš”ï¸Mnistæ‰‹å†™æ•°æ®é›†å®éªŒæŠ¥å‘Š
]
.subtitle[
## åŸºäºpytorchä¸fastai
]
.author[
### é™†ä½³æ¬¢
]
.author[
### åº”æ•°2001
]
.institute[
### æ•°ç§‘é™¢
]
.date[
### 2022-04-06
]

---






#æµç¨‹å››éƒ¨åˆ†

##  [ä¸€ã€å‡†å¤‡å·¥ä½œ](#3)
##  äºŒã€å®éªŒä¸»ä½“
##  ä¸‰ã€å®éªŒæ€»ç»“
##  å››ã€è‡´è°¢

---
class: inverse, center, middle

#  ä¸€ã€å‡†å¤‡å·¥ä½œ

---
##å‡†å¤‡(March 31)
###1.beammerä¸»é¢˜çš„åˆ¶ä½œ
  - è®¾è®¡logo 
  - å­¦ä¹ å…¶ä»–å¤§å­¦çš„æºä»£ç 

### æˆæœå±•ç¤º
![](https://s3.bmp.ovh/imgs/2022/04/04/ca39abe3fcc313d5.png)
---
###2.å®‰è£… pytorch_gpuä»¥åŠCUDAã€cudnn
 

- [å®‰è£…GPUç‰ˆæœ¬Pytorch](https://blog.csdn.net/baidu_26646129/article/details/88380598?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164873265716782184627137%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=164873265716782184627137&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-88380598.142^v5^pc_search_insert_es_download,143^v6^register&amp;utm_term=anaconda%E5%AE%89%E8%A3%85pytorch-gpu&amp;spm=1018.2226.3001.4187) &amp;#x1F98C;
- [cudaå®‰è£…æ•™ç¨‹+cudnnå®‰è£…æ•™ç¨‹](https://blog.csdn.net/sinat_23619409/article/details/84202651) &amp;#x1F98C;
- [pytorchï¼šæµ‹è¯•GPUæ˜¯å¦å¯ç”¨](https://blog.csdn.net/weixin_42788078/article/details/103116903) &amp;#x1F98C;
 
#### &amp;#x270D;å®‰è£…æµç¨‹ä¸­å‡ºç°çš„å¯èƒ½é—®é¢˜ 
  &gt;åœ¨å¤åˆ¶cudaé“¾æ¥çš„æ—¶å€™éœ€è¦å¯¹åº”ç‰ˆæœ¬ã€‚
  &gt;
  &gt;ç›´æ¥å¤åˆ¶å¯èƒ½ä¸‹è½½ä¸äº†(3ä¸ªç¨‹åºåŒ…),éœ€è¦åˆ†åˆ«å¼€ä¸‹è½½ã€‚
  &gt;
  &gt;ä¸è¦ç›´æ¥å®‰è£…pyotchæˆ–è€…ç”¨æ¸…åæºè¿™æ ·ä¼šå®‰è£…cpuç‰ˆã€‚

---
class: inverse, center, middle

#  äºŒã€å®éªŒä¸»ä½“ 

---
### Multilayer perceptron(MLP) 3å±‚
``` python 
class MLPNet(nn.Module):
    def __init__(self, input_size, hidden_size, num_out):
        super(MLPNet, self).__init__()
        self.input_size = input_size
        self.h1 = nn.Linear(input_size, hidden_size)
        self.relu1 = nn.ReLU()
        self.out = nn.Linear(hidden_size, num_out)
        self.softmax=nn.Softmax(dim=1) 

    def forward(self, x):
        h1 = self.h1(x)
        a1 = self.relu1(h1)
        out = self.out(a1)
        return out
```
---
### MLPå®éªŒç»“æœ

- pycharmä¸Šè¿è¡Œç»“æœ

![](https://s3.bmp.ovh/imgs/2022/04/04/7512e374e69fe531.jpg)





- jupyterç¯å¢ƒä¸­

![](https://s3.bmp.ovh/imgs/2022/04/04/0470f8906e604528.jpg)
---
###  LeNet 5å±‚
```python
class LeNet(nn.Module):
    def __init__(self):
        super(LeNet, self).__init__()  
        self.conv1 = nn.Conv2d(in_channels=1, out_channels=6, kernel_size=5)  # 6 * 24 * 24
        self.conv2 = nn.Conv2d(in_channels=6, out_channels=16, kernel_size=5)  # 16 * 8 * 8
        self.fc1 = nn.Linear(in_features=16 * 4 * 4, out_features=120)  # 16 * 4 * 4
        self.fc2 = nn.Linear(in_features=120, out_features=84)
        self.fc3 = nn.Linear(in_features=84, out_features=10)
        
    def forward(self, x):
        x = F.max_pool2d(F.relu(self.conv1(x)), (2, 2))
        x = F.max_pool2d(F.relu(self.conv2(x)), 2)
        x = torch.flatten(x, 1)   
        x = F.relu(self.fc1(x))
        x = F.relu(self.fc2(x))
        x = self.fc3(x)
        return x
```
---
### LeNetå®éªŒç»“æœ
- pycharmä¸­è¿è¡Œç»“æœ

![](https://s3.bmp.ovh/imgs/2022/04/04/8118c80220bb3f85.jpg)

- jupyterä¸­è·‘10epoch

 &lt;img src = 'https://s3.bmp.ovh/imgs/2022/04/04/2cdeae124e2e767a.png' width="400" height="213"/&gt;

---
### AlexNet 8å±‚æ‰‹å†™
```python
class AlexNet(nn.Module):
    def __init__(self):
        super(AlexNet, self).__init__()  
        self.conv1=nn.Conv2d(in_channels=1,out_channels=96,kernel_size=11,stride=4,padding=1)
        self.conv2=nn.Conv2d(in_channels=96,out_channels=256,kernel_size=5,padding=2)
        self.conv3=nn.Conv2d(256,384,kernel_size=3,padding=1)
        self.conv4=nn.Conv2d(384,384,kernel_size=3,padding=1)
        self.conv5=nn.Conv2d(384,256,kernel_size=3,padding=1)
        self.fc1=nn.Linear(6400,4096)
        self.fc2=nn.Linear(4096,4096)
        self.fc3=nn.Linear(4096,10)
    def forward(self, x):                   
        x=F.max_pool2d(F.relu(self.conv1(x)),kernel_size=3,stride=2)
        x=F.max_pool2d(F.relu(self.conv2(x)),kernel_size=3,stride=2)
        x=F.relu(self.conv3(x))
        x=F.relu(self.conv4(x))
        x=F.max_pool2d(F.relu(self.conv5(x)),kernel_size=3,stride=2)
        x=torch.flatten(x,1)
        x=F.relu(self.fc1(x))
        x=F.dropout(x,p=0.5)
        x=F.relu(self.fc2(x))
        x=F.dropout(x,p=0.5)
        x=self.fc3(x)
        return x
```
---
### AlexNet 8å±‚æ¨¡å—åŒ–
```python
class AlexNet(nn.Module):
    def __init__(self):
        super(AlexNet, self).__init__()  #  
        self.layer1 = nn.Sequential(
            nn.Conv2d(1,32,kernel_size=3,padding=1),
            nn.MaxPool2d(kernel_size=2,stride=2)  ,    
            nn.ReLU(inplace=True),
        )
        self.layer2 = nn.Sequential(
            nn.Conv2d(32,64,kernel_size=3,padding=1),
            nn.MaxPool2d(kernel_size=2,stride=2),
            nn.ReLU(inplace=True),
        )
        self.layer3 = nn.Sequential(
            nn.Conv2d(64,128,kernel_size=3,padding=1),
        )
        self.layer4 = nn.Sequential(
            nn.Conv2d(128,256,kernel_size=3,padding=1),
        )
      
```

---
### AlexNet 8å±‚æ¨¡å—åŒ–
```python
  self.layer5 = nn.Sequential(
            nn.Conv2d(256,256,kernel_size=3,padding=1),
            nn.MaxPool2d(kernel_size=3, stride=2),
            nn.ReLU(inplace=True),
        )

      #å®šä¹‰å…¨è¿æ¥å±‚
        self.fc1 = nn.Linear(256 * 3 * 3,1024)
        self.fc2 = nn.Linear(1024,512)
        self.fc3 = nn.Linear(512,10)
        #å¯¹åº”åä¸ªç±»åˆ«çš„è¾“å‡º

    def forward(self,x):
        x = self.layer1(x)
        x = self.layer2(x)
        x = self.layer3(x)
        x = self.layer4(x)
        x = self.layer5(x)
        x = x.view(-1,256*3*3)
        x = self.fc1(x)
        x = self.fc2(x)
        x = self.fc3(x)

        return x

```
---
### AlexNet å¤±è´¥
![](https://s3.bmp.ovh/imgs/2022/04/04/3a0b47717382bd5c.jpg)

**åŸå› **ï¼šå®šä¹‰ Adam ä¼˜åŒ–å™¨ç”¨äºæ¢¯åº¦ä¸‹é™,åœ¨ç¬¬ä¸€ä¸ªepochçš„[1,200]å‡ºç°çš„è¾ƒå¤§è¯¯å·®å¯¼è‡´æ•´ä½“å˜å·®ï¼Œæ”¹ç”¨SGDã€‚
---
### AlexNet æ‰‹å†™ç»“æœ

![](https://s3.bmp.ovh/imgs/2022/04/04/e4c2a9c23059b592.jpg)
    
   
**10epochå¹³å‡**

![](https://s3.bmp.ovh/imgs/2022/04/04/a6d0ab8fdf5514f4.jpg)

---
### AlexNet æ¨¡å—åŒ–ç»“æœ

![](https://s3.bmp.ovh/imgs/2022/04/04/79ecf57c8cdfed7e.jpg)

**10epochå¹³å‡**

![](https://s3.bmp.ovh/imgs/2022/04/04/41242590b9e8c418.png)

---
### GoogLeNet 
.pull-left[
####  inception V1

![](https://s3.bmp.ovh/imgs/2022/04/04/fca49cc5df1703be.jpg)
]

.pull-right[

#### googlenetç½‘ç»œç»“æ„

&lt;img src = 'https://s3.bmp.ovh/imgs/2022/04/04/7927d108a41abcd2.jpg' width="400" height="413"/ &gt;
]
---
###  googLeNet
```python
class Inception(nn.Module):
    def __init__(self, in_channels, c1, c2, c3, c4, **kwargs):
        super(Inception, self).__init__(**kwargs)
        self.p1_1 = nn.Conv2d(in_channels, c1, kernel_size=1)
        self.p2_1 = nn.Conv2d(in_channels, c2[0], kernel_size=1)
        self.p2_2 = nn.Conv2d(c2[0], c2[1], kernel_size=3, padding=1)
        self.p3_1 = nn.Conv2d(in_channels, c3[0], kernel_size=1)
        self.p3_2 = nn.Conv2d(c3[0], c3[1], kernel_size=5, padding=2)
        self.p4_1 = nn.MaxPool2d(kernel_size=3, stride=1, padding=1)
        self.p4_2 = nn.Conv2d(in_channels, c4, kernel_size=1)
        
    def forward(self, x):
        p1 = F.relu(self.p1_1(x))
        p2 = F.relu(self.p2_2(F.relu(self.p2_1(x))))
        p3 = F.relu(self.p3_2(F.relu(self.p3_1(x))))
        p4 = F.relu(self.p4_2(self.p4_1(x))
        return torch.cat((p1, p2, p3, p4), dim=1)

```
---
```python
 class GoogleNet(torch.nn.Module):
    def __init__(self):
        super(GoogleNet,self).__init__()
        self.block1=b1 = nn.Sequential(nn.Conv2d(1, 64, kernel_size=7, stride=2, padding=3),
                   nn.ReLU(),
                   nn.MaxPool2d(kernel_size=3, stride=2, padding=1))
        self.block2=nn.Sequential(nn.Conv2d(64, 64, kernel_size=1),
                   nn.ReLU(),
                   nn.Conv2d(64, 192, kernel_size=3, padding=1),
                   nn.ReLU(),
                   nn.MaxPool2d(kernel_size=3, stride=2, padding=1))
        self.block3=nn.Sequential(Inception(192, 64, (96, 128), (16, 32), 32),
                   Inception(256, 128, (128, 192), (32, 96), 64),
                   nn.MaxPool2d(kernel_size=3, stride=2, padding=1))
        self.block4=nn.Sequential(Inception(480, 192, (96, 208), (16, 48), 64),
                   Inception(512, 160, (112, 224), (24, 64), 64),
                   Inception(512, 128, (128, 256), (24, 64), 64),
                   Inception(512, 112, (144, 288), (32, 64), 64),
                   Inception(528, 256, (160, 320), (32, 128), 128),
                   nn.MaxPool2d(kernel_size=3, stride=2, padding=1))
      
```
---
```python
   self.block5=nn.Sequential(Inception(832, 256, (160, 320), (32, 128), 128),
                   Inception(832, 384, (192, 384), (48, 128), 128),
                   nn.AdaptiveAvgPool2d((1,1)),
                   nn.Flatten()) 
    def forward(self,x):
        x=self.block1(x)
        x=self.block2(x)
        x=self.block3(x)
        x=self.block4(x)
        x=self.block5(x)        
        return x

```
---
 ###ä¸æ¨èå†™æ³•(æ‰‹å†™)
 
![](https://s3.bmp.ovh/imgs/2022/04/04/b9ee90b416d402b8.jpg)


---
### GoogLeNetå®éªŒç»“æœ

![](https://s3.bmp.ovh/imgs/2022/04/04/5a2b70dd170ff581.jpg)

**åŸå› **ï¼šæœªçŸ¥(æ²¡æœ‰lossç‰¹åˆ«å¤§çš„å€¼ï¼Œå‡2å·¦å³)

---
### åŸºäºfastaiçš„ResNet
 
####  ResNet18
``` python
# ä½¿ç”¨è·¯å¾„åˆ›å»ºä¸€ä¸ªå›¾åƒæ•°æ®è½¬æ¢å™¨å¯¹è±¡
dls = ImageDataLoaders.from_folder(path, train='training', 
                                   valid='testing')
learn = cnn_learner(dls, resnet18, pretrained=False,
                    loss_func=LabelSmoothingCrossEntropy(),  #æ ‡ç­¾å¹³æ»‘
                    metrics=accuracy)
learn.fit_one_cycle(1, 0.1)
```

 
####  ResNet34

``` pyrhon

# ä½¿ç”¨è·¯å¾„åˆ›å»ºä¸€ä¸ªå›¾åƒæ•°æ®è½¬æ¢å™¨å¯¹è±¡
dls = ImageDataLoaders.from_folder(path, train='training', 
                                   valid='testing')
learn = cnn_learner(dls, resnet34, pretrained=False,
                    loss_func=LabelSmoothingCrossEntropy(),  #æ ‡ç­¾å¹³æ»‘
                    metrics=accuracy)
learn.fit_one_cycle(1, 0.1)
 
```
---
###å®éªŒç»“æœå¯¹æ¯”

| | epoch	|train_loss	|valid_loss|	accuracy	|time|
|- - - | - - -| - - -| - - -| - -- | - - -| - - -|     
|**ResNet18**| 0	|0.561522|	0.526307|	0.991500|	12:55|
|**ResNet34**|0	|0.583426|	0.594473|	0.986200|	22:21|

---

### unfreez()å
.pull-left[#### ResNet18

|epoch|	train_loss|	valid_loss|	accuracy|	time|
|- - -|- - - |- - -|- - - |- - -|
|0|	0.559923|	0.525104|	0.990900|	10:18|
|1|	0.548604|	0.524869|	0.991600|	10:19|
|2|	0.549611|	0.524795|	0.991000|	10:22|


&lt;img src = 'https://s3.bmp.ovh/imgs/2022/04/04/4276d47a6a527466.png'width="400" height="213"/ &gt;
]

.pull-right[#### ResNet34

|epoch|	train_loss|	valid_loss|	accuracy|	time|
|- -  -|- - -| - - -| - - -| - - -|
|0|	0.578651|	0.543047|	0.987100|	16:14|
|1	|0.581934	|2.380104	|0.983400	|16:49|



&lt;img src = 'https://s3.bmp.ovh/imgs/2022/04/04/8040b52fde2f712e.png'width="400" height="213"/ &gt;
]

---
class: inverse, center, middle

#  ä¸‰ã€å®éªŒæ€»ç»“

---

## summary

- cvæ¥è®²ï¼Œå¯¹å›¾ç‰‡çš„å°ºå¯¸å¤„ç†å½±å“ç½‘ç»œçš„ä¹¦å†™ã€‚


- é€‰æ‹©ä¸åŒçš„ä¼˜åŒ–å™¨å¯èƒ½å½±å“æ¨¡å‹çš„æ•ˆæœè€Œä¸”æ˜¯ä¸å¯é€†çš„ã€‚


- å†™ç½‘ç»œä¸»ä½“çš„æ—¶å€™å°½å¯èƒ½ä½¿ç”¨æ¨¡å—åŒ–ï¼Œè¿™æ ·ä¼šå¾ˆæ¸…æ™°ã€‚


- æ•°æ®å¢å¼ºæ˜¯å»ºæ¨¡çš„å…³é”®éƒ¨åˆ†ï¼Œå®ƒä¸¥é‡å½±å“æ¨¡å‹çš„acc,trainä»¥åŠtestéƒ½æ˜¯å·®ä¸å¤šçš„ã€‚


- å¯ä»¥é€šè¿‡é›†æˆçš„åŒ…ï¼Œæ¥åšDNN,å¦‚D2l,æˆ–è€…fastai,å…¶ä¸­fastaiåœ¨æ•°æ®å¢å¼ºéƒ¨åˆ†åšçš„å¾ˆå¥½,å®ƒæœ‰ä¸€ç§mixupæœºåˆ¶,æ¯”pytorchä¼˜ç§€ã€‚

---
class: inverse, center, middle

# å››ã€æºæ–‡ä»¶ä¸è‡´è°¢
---
## æœ¬æ¬¡å®éªŒç›¸å…³jupyteråŠpyæ–‡ä»¶

.left-column[
#### [æºä»£ç åŠå¹»ç¯ç‰‡](https://github.com/Luhuanz)ğŸ—¹

#### [beamerä¸‹è½½åœ°å€](https://www.latexstudio.net/index/lists/barSearch/text/%E6%B1%9F%E8%8B%8F%E5%A4%A7%E5%AD%A6)ğŸ—¹

#### [Rå†™è½®çœ¼](https://zhuanlan.zhihu.com/p/346996909)ğŸ—¹
]




---
class: center, middle

# Thanks!




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%",
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
